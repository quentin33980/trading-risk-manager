// pages/index.tsx
"use client";

import { useState } from "react";

export default function Home() {
  const [capital, setCapital] = useState(1000);
  const [riskPercent, setRiskPercent] = useState(1);
  const [entry, setEntry] = useState(0);
  const [stopLoss, setStopLoss] = useState(0);
  const [takeProfit1, setTakeProfit1] = useState(0);
  const [takeProfit2, setTakeProfit2] = useState(0);

  const isValid = entry > 0 && stopLoss > 0 && takeProfit1 > 0 && takeProfit2 > 0 && entry !== stopLoss;

  const riskAmount = (capital * riskPercent) / 100;
  const positionSize = isValid ? riskAmount / Math.abs(entry - stopLoss) : 0;

  const pnl = (target: number) => (target - entry) * positionSize;
  const percentTradeReturn = (target: number) => ((target - entry) / Math.abs(entry - stopLoss)) * 100;
  const riskPercentTrade = ((entry - stopLoss) / entry) * 100;

  return (
    <main className="p-4 max-w-xl mx-auto">
      <h1 className="text-2xl font-bold mb-4">Trading Risk Manager</h1>
      <div className="grid grid-cols-2 gap-4">
        <label>Capital total (USDT):</label>
        <input type="number" value={capital} onChange={e => setCapital(parseFloat(e.target.value))} className="border p-1" />

        <label>Risque par trade (%):</label>
        <input type="number" value={riskPercent} onChange={e => setRiskPercent(parseFloat(e.target.value))} className="border p-1" />

        <label>Prix d'entrée:</label>
        <input type="number" value={entry} onChange={e => setEntry(parseFloat(e.target.value))} className="border p-1" step="any" />

        <label>Stop Loss:</label>
        <input type="number" value={stopLoss} onChange={e => setStopLoss(parseFloat(e.target.value))} className="border p-1" step="any" />

        <label>Take Profit 1:</label>
        <input type="number" value={takeProfit1} onChange={e => setTakeProfit1(parseFloat(e.target.value))} className="border p-1" step="any" />

        <label>Take Profit 2:</label>
        <input type="number" value={takeProfit2} onChange={e => setTakeProfit2(parseFloat(e.target.value))} className="border p-1" step="any" />
      </div>

      {isValid && (
        <div className="mt-6 space-y-2">
          <p><strong>Montant à investir :</strong> {positionSize.toFixed(2)} USDT</p>
          <p><strong>Perte si SL touché :</strong> -{riskAmount.toFixed(2)} USDT ({riskPercent.toFixed(2)}% du capital)</p>
          <p><strong>Gain si TP1 :</strong> +{pnl(takeProfit1).toFixed(2)} USDT ({percentTradeReturn(takeProfit1).toFixed(2)}% sur le trade)</p>
          <p><strong>Gain si TP2 :</strong> +{pnl(takeProfit2).toFixed(2)} USDT ({percentTradeReturn(takeProfit2).toFixed(2)}% sur le trade)</p>
          <p><strong>Perte sur trade si SL :</strong> -100.00% (sur le trade)</p>
        </div>
      )}

      {!isValid && <p className="mt-4 text-red-500">Veuillez saisir des valeurs valides (entrée, SL, TP ≠ 0 et entrée ≠ SL).</p>}
    </main>
  );
}
